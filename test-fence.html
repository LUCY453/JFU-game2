<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå­å›´æ æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .controls {
            margin-bottom: 20px;
        }
        .controls button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        
        #fenceCanvas {
            border: 2px solid #333;
            border-radius: 5px;
            cursor: crosshair;
            display: block;
            margin: 20px auto;
        }
        .status {
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }
        .instructions {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš§ ç”µå­å›´æ æµ‹è¯•</h1>
        
        <div class="status">
            <span>å›´æ çŠ¶æ€: </span>
            <span id="fenceStatus">æœªå¯ç”¨</span>
        </div>
        
        <div class="controls">
            <button id="drawBtn" onclick="toggleDrawing()" class="btn-primary">å¼€å§‹ç»˜åˆ¶</button>
            <button onclick="clearFence()" class="btn-warning">æ¸…ç©ºå›´æ </button>
            <button onclick="applyFence()" class="btn-success">åº”ç”¨å›´æ </button>
            <button id="toggleBtn" onclick="toggleFence()" class="btn-danger">å¯ç”¨å›´æ </button>
        </div>
        
        <canvas id="fenceCanvas" width="600" height="600"></canvas>
        
        <div class="instructions">
            <h3>ä½¿ç”¨è¯´æ˜:</h3>
            <ul>
                <li>ğŸ–±ï¸ ç‚¹å‡»"å¼€å§‹ç»˜åˆ¶"è¿›å…¥ç»˜åˆ¶æ¨¡å¼</li>
                <li>ğŸ“ åœ¨åœ°å›¾ä¸Šç‚¹å‡»æ·»åŠ å›´æ è¾¹ç•Œç‚¹</li>
                <li>ğŸ”— è‡³å°‘éœ€è¦3ä¸ªç‚¹å½¢æˆå›´æ </li>
                <li>âœ… ç‚¹å‡»"åº”ç”¨å›´æ "ä¿å­˜è®¾ç½®</li>
                <li>ğŸ”´ ç‚¹å‡»"å¯ç”¨å›´æ "æ¿€æ´»é™åˆ¶</li>
            </ul>
        </div>
        
        <div id="pointsList">
            <h3>å›´æ ç‚¹åˆ—è¡¨:</h3>
            <div id="points"></div>
        </div>
    </div>

    <script>
        let canvas = document.getElementById('fenceCanvas');
        let ctx = canvas.getContext('2d');
        let isDrawing = false;
        let fencePoints = [];
        let fenceEnabled = false;

        // ç»˜åˆ¶åŸºç¡€åœ°å›¾
        function drawBaseMap() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // è‰åœ°èƒŒæ™¯
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // é“è·¯ç½‘æ ¼
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 2;
            
            // ä¸»å¹²é“
            ctx.beginPath();
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            
            // æ¬¡è¦é“è·¯
            ctx.lineWidth = 1;
            for (let i = 1; i < 6; i++) {
                if (i !== 3) {
                    let pos = (i / 6) * canvas.width;
                    ctx.beginPath();
                    ctx.moveTo(0, pos);
                    ctx.lineTo(canvas.width, pos);
                    ctx.moveTo(pos, 0);
                    ctx.lineTo(pos, canvas.height);
                    ctx.stroke();
                }
            }
            
            // è¾¹ç•Œ
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.strokeRect(0, 0, canvas.width, canvas.height);
            
            // åæ ‡æ ‡è®°
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.fillText('-100', 10, 20);
            ctx.fillText('100', canvas.width - 30, 20);
            ctx.fillText('-100', 10, canvas.height - 10);
            ctx.fillText('100', canvas.width - 30, canvas.height - 10);
        }

        // ç»˜åˆ¶å›´æ 
        function drawFence() {
            if (fencePoints.length === 0) return;
            
            // ç»˜åˆ¶å›´æ ç‚¹
            ctx.fillStyle = '#0066ff';
            fencePoints.forEach(point => {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 6, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            // ç»˜åˆ¶å›´æ çº¿
            if (fencePoints.length > 1) {
                ctx.strokeStyle = fenceEnabled ? '#ff0000' : '#ff6666';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(fencePoints[0].x, fencePoints[0].y);
                
                for (let i = 1; i < fencePoints.length; i++) {
                    ctx.lineTo(fencePoints[i].x, fencePoints[i].y);
                }
                
                // é—­åˆå›´æ 
                if (fencePoints.length >= 3) {
                    ctx.lineTo(fencePoints[0].x, fencePoints[0].y);
                }
                
                ctx.stroke();
            }
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            drawBaseMap();
            drawFence();
            updatePointsList();
            updateStatus();
        }

        // æ›´æ–°å›´æ ç‚¹åˆ—è¡¨
        function updatePointsList() {
            const pointsDiv = document.getElementById('points');
            if (fencePoints.length === 0) {
                pointsDiv.innerHTML = '<p>æš‚æ— å›´æ ç‚¹</p>';
                return;
            }
            
            let html = '';
            fencePoints.forEach((point, index) => {
                const gameX = Math.round((point.x / canvas.width) * 200 - 100);
                const gameZ = Math.round((point.y / canvas.height) * 200 - 100);
                html += `<div>ç‚¹ ${index + 1}: (${gameX}, ${gameZ}) <button onclick="removePoint(${index})">åˆ é™¤</button></div>`;
            });
            pointsDiv.innerHTML = html;
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            const statusSpan = document.getElementById('fenceStatus');
            const toggleBtn = document.getElementById('toggleBtn');
            
            if (fenceEnabled && fencePoints.length >= 3) {
                statusSpan.textContent = 'å·²å¯ç”¨';
                statusSpan.style.color = '#dc3545';
                toggleBtn.textContent = 'ç¦ç”¨å›´æ ';
                toggleBtn.className = 'btn-success';
            } else {
                statusSpan.textContent = 'æœªå¯ç”¨';
                statusSpan.style.color = '#6c757d';
                toggleBtn.textContent = 'å¯ç”¨å›´æ ';
                toggleBtn.className = 'btn-danger';
            }
        }

        // åˆ‡æ¢ç»˜åˆ¶æ¨¡å¼
        function toggleDrawing() {
            isDrawing = !isDrawing;
            const drawBtn = document.getElementById('drawBtn');
            
            if (isDrawing) {
                drawBtn.textContent = 'åœæ­¢ç»˜åˆ¶';
                drawBtn.className = 'btn-danger';
                canvas.style.cursor = 'crosshair';
            } else {
                drawBtn.textContent = 'å¼€å§‹ç»˜åˆ¶';
                drawBtn.className = 'btn-primary';
                canvas.style.cursor = 'default';
            }
        }

        // æ¸…ç©ºå›´æ 
        function clearFence() {
            fencePoints = [];
            updateDisplay();
        }

        // åº”ç”¨å›´æ 
        function applyFence() {
            if (fencePoints.length < 3) {
                alert('è‡³å°‘éœ€è¦3ä¸ªç‚¹æ‰èƒ½å½¢æˆæœ‰æ•ˆå›´æ ');
                return;
            }
            alert(`å›´æ å·²åº”ç”¨ï¼åŒ…å« ${fencePoints.length} ä¸ªè¾¹ç•Œç‚¹`);
            updateDisplay();
        }

        // åˆ‡æ¢å›´æ å¯ç”¨çŠ¶æ€
        function toggleFence() {
            if (fencePoints.length < 3) {
                alert('è¯·å…ˆç»˜åˆ¶å›´æ ï¼ˆè‡³å°‘3ä¸ªç‚¹ï¼‰');
                return;
            }
            fenceEnabled = !fenceEnabled;
            updateDisplay();
        }

        // åˆ é™¤å›´æ ç‚¹
        function removePoint(index) {
            fencePoints.splice(index, 1);
            updateDisplay();
        }

        // ç”»å¸ƒç‚¹å‡»äº‹ä»¶
        canvas.addEventListener('click', function(event) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            fencePoints.push({ x, y });
            updateDisplay();
            
            const gameX = Math.round((x / canvas.width) * 200 - 100);
            const gameZ = Math.round((y / canvas.height) * 200 - 100);
            console.log(`æ·»åŠ å›´æ ç‚¹: (${gameX}, ${gameZ})`);
        });

        // åˆå§‹åŒ–
        updateDisplay();
    </script>
</body>
</html>